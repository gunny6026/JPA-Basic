# 일대다[1:N]

### 일대다 단방향

![image](https://user-images.githubusercontent.com/66653324/110602889-c5179a00-81c9-11eb-878b-59d8977283b0.png)

Team = 1 , Member = N  (일대다)  설계에서는

Team 입장에서는 Member 객체에 대한 정보를 알고 있고

Member 입장에서는 Team에 대한 정보를 알고 있지 않다.

DB의 경우,

DB설계상 잘 생각해보면  DB입장에서는 무조건 N쪽에 외래키가 있다. 

코드를 살펴보면

`Member.java` N = 다
```java

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
```
`Team.java` 1 = 일
```java
@Entity
public class Team {

    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    private String name;

    @OneToMany
    @JoinColumn(name = "TEAM_ID") // member 테이블에 FK키로 TEAM_ID 생성
    private List<Member> members = new ArrayList<>();

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public List<Member> getMembers() {
        return members;
    }

    public void setMembers(List<Member> members) {
        this.members = members;
    }
}
```

`JpaMain.java`
```java
public class JpaMain {
    public static void main(String[] args) {
      EntityManagerFactory emf =
              Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction();
        tx.begin();

        try{
          Member member = new Member();
          member.setUsername("member2");

          em.persist(member);

          Team team = new Team();
          team.setName("teamB");

          //DB team 테이블에 insert 될 수 없는 내용이다.
          team.getMembers().add(member);

          em.persist(team);
          tx.commit();
          System.out.println("team에 있는 member = "+team.getMembers());
        }catch (Exception e){
          tx.rollback();
        }finally {
          em.close();
        }
      emf.close();
    }
}
```
team 테이블에 team entity에 있는 members 객체는 insert 될 수 없다.

외래키는 team테이블에 있는 것이 아니라, member테이블에 있다.

그래서 member테이블에 있는 FK키 team_id를 update 해줘야한다.

실제로 실행을 하면 
1. member 테이블에 id(member_id) , username 값 insert
2. team 테이블에 id(team_id), name 값 insert
3. member 테이블에 있는 team_id(fk키) 값 update

순서이다.

--------------------
#### 예시

```java
 Member member = new Member();
          member.setUsername("호날두");

          em.persist(member);
```
멤버에 값을 추가 해보았다.

![image](https://user-images.githubusercontent.com/66653324/110609385-820cf500-81d0-11eb-9975-1990e36f3bac.png)


멤버와 팀에 값을 넣어보았다.

```java
 Member ramzy = new Member();
          ramzy.setUsername("아론 램지");

          em.persist(ramzy);

          Team juventus = new Team();
          juventus.setName("유벤투스");

          //DB team 테이블에 insert 될 수 없는 내용이다.
          juventus.getMembers().add(ramzy);

          em.persist(juventus);
          tx.commit();
```

결과는

![image](https://user-images.githubusercontent.com/66653324/110610121-40c91500-81d1-11eb-8f9c-6692164d81da.png)

호날두에 팀을 설정해주자

```java
  Member cr7 = em.find(Member.class, 3L);

          Team juventus = em.find(Team.class, 2L);
          
          juventus.getMembers().add(cr7);

          em.persist(juventus);
          tx.commit();
```

결과는

![image](https://user-images.githubusercontent.com/66653324/110610868-fe540800-81d1-11eb-8d73-0d5be8de00a7.png)


### 정리 

Team 테이블에 team_id랑 name에 값을 넣었다.

근데, Member 테이블에 외래키 team_id는 어떻게 넣어줄건데??

update 할 수 밖에 없다.

즉 쿼리가 한 번 더 나가야한다. update 쿼리가 한 번 더 나간다고 해서 성능 상 크게 뭐 없긴한데,

실무에서 잘 안쓰는 이유는 member 테이블, team 테이블에 insert 했는데,

콘솔에 보면 team 테이블에 update가 있으니깐 헷갈릴 수 있다.

테이블이 수십 개가 있으면 운영이 어렵다.

![image](https://user-images.githubusercontent.com/66653324/110614236-7bcd4780-81d5-11eb-8de5-3ccdf4f3774e.png)


![image](https://user-images.githubusercontent.com/66653324/110716312-3bf47780-824a-11eb-96bd-29910cd09af4.png)

### 일대다 양방향

![image](https://user-images.githubusercontent.com/66653324/110716488-9f7ea500-824a-11eb-8275-eba8f89b10bc.png)

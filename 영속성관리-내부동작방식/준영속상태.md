# 준영속 상태

- 영속 -> 준영속
- 영속 상태의 엔티티가 영속성 컨텍스트에서 분리(detached)
- 영속성 컨텍스트가 제공하는 기능을 사용 못함


em.persist 를 하면 영속 상태가 되지만

em.find로 DB에 있는 데이터를 1차캐시에 가져오는 것도 영속 상태이다.

```java
 Member mm = em.find(Member.class, 5L);
            mm.setUsername("케빈 데브라이너");

            em.detach(mm);

            System.out.println("=====================================");

            tx.commit();

```

detach를 통해 준영속 상태로 만들게 되면

이제 JPA에서 관리를 하지 않는다

그렇기 때문에 commit을 해도 아무 일도 일어나지 않는다.

em.flush()를 해도 마찬가지이다. 준영속 상태이기 때문에 JPA에서 관리 하지 않는다.

em.detach() 이외에 em.clear()를 해도 마찬가지이다.

em.clear()는 영속성 컨텍스트를 다 날려버린다는 뜻이다.

```java

            Member mm = em.find(Member.class, 5L);
            mm.setUsername("케빈 데브라이너");

            em.clear();

           Member mm2 = em.find(Member.class, 5L);
           
            
            System.out.println("=====================================");

            tx.commit();

```

원래라면 id 값이 5L인 데이터를 불러오면 1차캐시 , 즉 영속성 컨텍스트에 저장 되기 때문에

똑같은 데이터를 불러오면 1차캐시에서 불러오기 때문에 select 쿼리가 나가지 않는다.

하지만 em.clear()를 하고 난 뒤 다시 부르면

1차캐시에서 날라갔기 때문에 다시 select로 데이터를 가져와야한다.


## 준영속 상태로 만드는 방법

- em.detach(entity)

특정 엔티티만 준영속 상태로 전환

- em.clear()

영속성 컨텍스트를 완전히 초기화

- em.close

영속성 컨텍스트를 종료